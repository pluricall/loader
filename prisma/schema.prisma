generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum EntityNameEnum {
  ACTIVITY
  CONTACT_PROFILE
  CONSENT
  DNCL_ENTRY
  TABLE_SCHEMA_ENUM_VALUE
  WF_PROCESS_INSTANCE
}

enum LoadingModeEnum {
  APPEND
  UPDATE
  APPEND_OR_UPDATE
  REPLACE
}

enum BdType {
  EXTERNAL
  INTERNAL
}

enum Status {
  ACTIVE
  INACTIVE
}

enum Frequency {
  DAILY
  WEEKLY
  MONTHLY
}

model Clients {
  id                   String     @id @default(uuid())
  client               String
  status               Status
  contact_dpo          String?
  contact_ex_dto       String?
  info_ex_dto          String?
  owner                String
  ftp_path             String
  recording_devolution Frequency?
  created_at           DateTime   @default(now())
  updated_at           DateTime?
  bds                  Bds[]

  @@map("clients")
}

model Bds {
  id                 String  @id @default(uuid())
  client_id          String
  client_id_from_plc String?
  type               BdType
  user               String?
  status             Status
  bd_name            String
  code               String  @unique
  origin             String

  created_at DateTime  @default(now())
  updated_at DateTime?

  client Clients @relation(fields: [client_id], references: [id], onDelete: Cascade)
  source Source?

  @@map("bds")
}

model Source {
  id           String  @id @default(uuid())
  origin       String
  name         String
  local_path   String?
  host         String?
  password     String?
  username     String?
  port         Int?
  full_url     String?
  frequency    String
  start_time   String
  end_time     String
  interval     Int
  day_of_week  Int[]
  day_of_month Int[]

  created_at DateTime  @default(now())
  updated_at DateTime?

  bd_id String @unique
  bd    Bds    @relation(fields: [bd_id], references: [id])

  @@map("sources")
}

model Typ {
  id           String          @id @default(uuid())
  name         String          @unique
  separator    String
  entity_name  EntityNameEnum
  loading_mode LoadingModeEnum
  fields       String[]
  fixed_fields Json
  created_at   DateTime        @default(now())
  updated_at   DateTime?

  @@map("typs")
}

model LoadersTask {
  id                 String   @id @default(uuid())
  task_id            Int
  status             String
  status_description String
  percentage_done    Int
  creation_moment    DateTime
  start_moment       DateTime
  end_moment         DateTime
  internal           String?

  @@map("loaders_task")
}
